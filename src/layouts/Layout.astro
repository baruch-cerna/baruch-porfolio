---
import { getLangFromUrl } from "../i18n/utils";
import "../styles/global.css";
interface Props {
  title: string;
}
const { title } = Astro.props;
const yoe = new Date().getFullYear() - 2020;
const description = `Desarrollador Web Full Stack con +${yoe} a√±os de experiencia en desarrollo de productos digitales. Experto en Node.js, Django, Angular y React.`;
const lang = getLangFromUrl(Astro.url);
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta
      name="keywords"
      content="Full Stack Developer, Full Stack Web Developer, Node.js, Django, Angular, React, JavaScript, Typescript, Python, MongoDB, PostgreSQL, MySQL, Desarrollo web, Programaci√≥n, Desarrollo de software, SEO, API, Dise√±o de patrones, Arquitectura de software, Liderazgo, M√©xico"
    />
    <meta name="author" content="Baruch Cerna" />
    <meta name="robots" content="index, follow" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="profile" />
    <meta property="og:url" content="https://baruch-cerna.dev" />
    <meta
      property="og:image"
      content="https://baruch-cerna.dev/media/logo_blanco2.jpg"
    />
    <meta property="og:site_name" content="Portafolio de Baruch Cerna" />
    <meta name="viewport" content="width=device-width" />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <link rel="icon" type="image/svg+xml" href="/media/logo_blanco.svg" />
    <link rel="apple-touch-icon" href="/media/logo_blanco.svg" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Host+Grotesk:wght@300..800&family=Space+Mono:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <title>{title}</title>
  </head>
  <body
    class="bg-[#050505] text-[#e5e5e5] antialiased selection:bg-white selection:text-black"
  >
    <slot />
  </body>
</html>
<script>
  import Lenis from "lenis";
  import { animate, inView } from "motion";
  import gsap from "gsap";
  import SplitText from "gsap/SplitText";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  gsap.registerPlugin(ScrollTrigger);
  gsap.registerPlugin(SplitText);
  const lenis = new Lenis({
    duration: 1.5,
    easing: (x) => 1 - Math.pow(1 - x, 3),
  });
  function raf(time: number) {
    lenis.raf(time);
    requestAnimationFrame(raf);
  }
  requestAnimationFrame(raf);
  const sequenceTime = 2.2;
  const sequence: any[] = [
    [
      ".logo-svg",
      { rotate: [180, 0, -180] },
      { ease: "circInOut", duration: sequenceTime / 2 },
    ],
  ];
  document.querySelectorAll("[data-horizontal]").forEach((el) => {
    const componentId = (el as HTMLElement).dataset.horizontal as string;
    const enableSnap = (el as HTMLElement).dataset.horizontalSnap === "true";
    const section = document.getElementById(componentId);
    if (section) {
      const races = section.getElementsByClassName(
        "swipe-section",
      )[0] as HTMLElement;
      const panels = Array.from(
        races.getElementsByClassName("panel"),
      ) as HTMLElement[];
      panels.forEach((panel) => {
        panel.style.width = `100dvw`;
      });
      races.style.width = `${panels.length * 100}dvw`;

      function getScrollAmount() {
        const racesWidth = races.scrollWidth;
        return -(racesWidth - window.innerWidth);
      }

      const tween = gsap.to(races, {
        x: getScrollAmount,
        duration: 3,
        ease: "none",
      });

      ScrollTrigger.create({
        trigger: section,
        start: "top 0%",
        end: () => `+=${getScrollAmount() * -1}`,
        pin: true,
        animation: tween,
        scrub: 1,
        invalidateOnRefresh: true,
        // markers: true,
      });
    }
  });
  animate(sequence, {
    delay: 1,
    ease: "circInOut",
  });
  inView(".path-list li", (element) => {
    animate(
      element,
      {
        opacity: 1,
        transform: ["translate(-50px)", "translate(0)"],
      } as any,
      {
        duration: 0.9,
        easing: [0.17, 0.55, 0.55, 1],
      } as any,
    );
    return () => animate(element, { opacity: 0, y: [50, 0] });
  });
  const animationFuns: Record<string, (element: Element) => void> = {
    quote: (element: Element) => {
      SplitText.create(element, {
        type: "words, chars",
        onSplit(self) {
          gsap.from(self.chars, {
            duration: 1,
            autoAlpha: 0,
            stagger: 1 / self.chars.length,
            ease: "power4.out",
          });
        },
      });
    },
  };
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("is-visible");
          const animation: string =
            (entry.target as HTMLElement).dataset?.animate || "";
          const animationFun = animationFuns[animation];
          if (animationFun) animationFun(entry.target);
        } else {
          entry.target.classList.remove("is-visible");
        }
      });
    },
    { threshold: 0.2 },
  );

  document.querySelectorAll("[data-animate], .reveal").forEach((el) => {
    const classes = el.classList;
    const hasClip = classes
      .values()
      .some((className) => className.includes("clip"));
    const hasQuote = classes
      .values()
      .some((className) => className.includes("quote"));
    if (hasClip) {
      const innerHTML = el.innerHTML;
      el.innerHTML = "";
      const span = document.createElement("span");
      span.innerHTML = innerHTML;
      el.appendChild(span);
    }
    if (hasQuote) {
      // const slipSpans =
    }
    observer.observe(el);
  });
</script>
<style is:global>
  /* ======================================
   üåê DESIGN¬†TOKENS
   ====================================== */
  :root {
    --bg-color: #050505;
    --text-primary: #e5e5e5;
    --text-secondary: #a3a3a3;
  }

  /* Custom Scrollbar */
  ::-webkit-scrollbar {
    width: 6px;
  }
  ::-webkit-scrollbar-track {
    background: #000;
  }
  ::-webkit-scrollbar-thumb {
    background: #333;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: #555;
  }

  /* Glitch Animations */
  @keyframes glitch-anim-1 {
    0% {
      clip-path: inset(20% 0 80% 0);
      transform: translate(-2px, 0);
    }
    20% {
      clip-path: inset(60% 0 10% 0);
      transform: translate(2px, 0);
    }
    40% {
      clip-path: inset(40% 0 50% 0);
      transform: translate(-2px, 0);
    }
    60% {
      clip-path: inset(80% 0 5% 0);
      transform: translate(2px, 0);
    }
    80% {
      clip-path: inset(10% 0 70% 0);
      transform: translate(-1px, 0);
    }
    100% {
      clip-path: inset(30% 0 50% 0);
      transform: translate(1px, 0);
    }
  }

  @keyframes glitch-anim-2 {
    0% {
      clip-path: inset(10% 0 60% 0);
      transform: translate(2px, 0);
    }
    20% {
      clip-path: inset(30% 0 20% 0);
      transform: translate(-2px, 0);
    }
    40% {
      clip-path: inset(70% 0 10% 0);
      transform: translate(2px, 0);
    }
    60% {
      clip-path: inset(20% 0 50% 0);
      transform: translate(-2px, 0);
    }
    80% {
      clip-path: inset(50% 0 30% 0);
      transform: translate(1px, 0);
    }
    100% {
      clip-path: inset(0% 0 90% 0);
      transform: translate(-1px, 0);
    }
  }

  .reveal {
    opacity: 0;
    filter: blur(4px);
    transform: translateY(20px);
    transition: all 1s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .reveal.is-visible {
    opacity: 1;
    filter: blur(0);
    transform: translateY(0);
  }

  .horizontal-section {
    overflow-x: clip;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    width: 100vw;

    .swipe-section {
      display: flex;
      flex-wrap: nowrap;
      height: 100%;

      .panel {
        height: 100%;
        overflow-x: clip;
        width: 100dvw;
        display: flex;
        align-items: center;
        justify-content: center;

        & > div,
        section {
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
        }
      }
    }
  }
</style>
